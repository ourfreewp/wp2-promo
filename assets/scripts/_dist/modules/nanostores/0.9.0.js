/* esm.sh - nanostores@0.9.0 */
var m=0,h=[];function v(){return m+=1,()=>{if(m-=1,m===0){let e=h;h=[];for(let t of e)t()}}}function R(e){let t=v();return e().finally(t)}function _(){return m===0?Promise.resolve():new Promise(e=>{h.push(e)})}function N(){m=0}var g=Symbol("clean"),I=(...e)=>{throw new Error("cleanStores() can be used only during development or tests")};var L=0,D=1,w=2,Y=3,C=5,T=6,K=7,y=10,c=(e,t,r,n)=>(e.events=e.events||{},e.events[r+y]||(e.events[r+y]=n(i=>{e.events[r].reduceRight((o,l)=>(l(o),o),{shared:{},...i})})),e.events[r]=e.events[r]||[],e.events[r].push(t),()=>{let i=e.events[r],o=i.indexOf(t);i.splice(o,1),i.length||(delete e.events[r],e.events[r+y](),delete e.events[r+y])}),F=(e,t)=>c(e,t,L,r=>{let n=e.listen;return e.listen=i=>(!e.lc&&!e.starting&&(e.starting=!0,r(),delete e.starting),n(i)),()=>{e.listen=n}}),Q=(e,t)=>c(e,t,D,r=>{let n=e.off;return e.off=()=>{r(),n()},()=>{e.off=n}}),V=(e,t)=>c(e,t,w,r=>{let n=e.set,i=e.setKey;return e.setKey&&(e.setKey=(o,l)=>{let f;if(r({abort:()=>{f=!0},changed:o,newValue:{...e.value,[o]:l}}),!f)return i(o,l)}),e.set=o=>{let l;if(r({abort:()=>{l=!0},newValue:o}),!l)return n(o)},()=>{e.set=n,e.setKey=i}}),B=(e,t)=>c(e,t,Y,r=>{let n=e.notify;return e.notify=i=>{let o;if(r({abort:()=>{o=!0},changed:i}),!o)return n(i)},()=>{e.notify=n}}),O=1e3,S=(e,t)=>c(e,n=>{let i=t(n);i&&e.events[T].push(i)},C,n=>{let i=e.listen;e.listen=(...l)=>(!e.lc&&!e.active&&(e.active=!0,n()),i(...l));let o=e.off;return e.events[T]=[],e.off=()=>{o(),setTimeout(()=>{if(e.active&&!e.lc){e.active=!1;for(let l of e.events[T])l();e.events[T]=[]}},O)},()=>{e.listen=i,e.off=o}}),X=(e,t)=>c(e,t,K,r=>{let n={},i={},o=e.action;return e.action=(l,f,u)=>(r({id:l,actionName:f,args:u,onEnd:a=>{(i[l]||(i[l]=[])).push(a)},onError:a=>{(n[l]||(n[l]=[])).push(a)}}),[a=>{if(n[l])for(let x of n[l])x({error:a})},()=>{if(i[l]){for(let a of i[l])a();delete n[l],delete i[l]}}]),()=>{e.action=o}});var d=Symbol(),A=Symbol(),q=0,z=(e,t,r,n)=>{let i=++q,o={...e};o.set=(...f)=>{e[d]=t,e[A]=i,e.set(...f),delete e[d],delete e[A]},e.setKey&&(o.setKey=(...f)=>{e[d]=t,e[A]=i,e.setKey(...f),delete e[d],delete e[A]});let l=r(o,...n);if(l instanceof Promise){let[f,u]=typeof e.action<"u"?e.action(i,t,n):[],a=v();return l.catch(x=>{throw f&&f(x),x}).finally(()=>{a(),u&&u()})}return l},G=(e,t,r)=>(...n)=>z(e,t,r,n);function H(e,t,r){let n=new Set([...t,void 0]);return e.listen((i,o)=>{n.has(o)&&r(i,o)})}var J=e=>{e.listen(()=>{})};var s=[],p=(e,t)=>{let r=[],n={lc:0,l:t||0,value:e,set(i){n.value!==i&&(n.value=i,n.notify())},get(){return n.lc||n.listen(()=>{})(),n.value},notify(i){let o=!s.length;for(let l=0;l<r.length;l+=2)s.push(r[l],n.value,i,r[l+1]);if(o){for(let l=0;l<s.length;l+=4){let f=!1;for(let u=l+7;u<s.length;u+=4)if(s[u]<s[l+3]){f=!0;break}f?s.push(s[l],s[l+1],s[l+2],s[l+3]):s[l](s[l+1],s[l+2])}s.length=0}},listen(i,o){return n.lc=r.push(i,o||n.l)/2,()=>{let l=r.indexOf(i);~l&&(r.splice(l,2),n.lc--,n.lc||n.off())}},subscribe(i,o){let l=n.listen(i,o);return i(n.value),l},off(){}};return n};var W=(e,t)=>{Array.isArray(e)||(e=[e]);let r=[],n=()=>{let o=e.map(l=>l.get());o.some((l,f)=>l!==r[f])&&(r=o,i.set(t(...o)))},i=p(void 0,Math.max(...e.map(o=>o.l))+1);return S(i,()=>{let o=e.map(l=>l.listen(n,i.l));return n(),()=>{for(let l of o)l()}}),i};function M(e,t){let r=P(t),n=e;for(let i of r){if(n===void 0)break;n=n[i]}return n}function k(e,t,r){return U(e??{},P(t),r)}function U(e,t,r){let n=t[0];Z(e,n,t[1]);let i=Array.isArray(e)?[...e]:{...e};if(t.length===1)return r===void 0?Array.isArray(e)?i.splice(n,1):delete i[n]:i[n]=r,i;let o=U(e[n],t.slice(1),r);return e[n]=o,e}var E=/(.*)\[(\d+)\]/;function P(e){return e.split(".").flatMap(t=>E.test(t)?t.match(E).slice(1):[t])}function Z(e,t,r){if(t in e)return;let n=parseInt(r??"");Number.isNaN(n)?e[t]={}:e[t]=Array(n+1).fill(void 0)}function $(e={}){let t=p(e);return t.setKey=(r,n)=>{M(t.value,r)!==n&&(t.value=k(t.value,r,n),t.notify(r))},t}var b=(e={})=>{let t=p(e);return t.setKey=function(r,n){typeof n>"u"?r in t.value&&(t.value={...t.value},delete t.value[r],t.notify(r)):t.value[r]!==n&&(t.value={...t.value,[r]:n},t.notify(r))},t};export{O as STORE_UNMOUNT_DELAY,G as action,_ as allTasks,p as atom,g as clean,I as cleanStores,N as cleanTasks,W as computed,$ as deepMap,J as keepMount,d as lastAction,H as listenKeys,b as map,X as onAction,S as onMount,B as onNotify,V as onSet,F as onStart,Q as onStop,v as startTask,R as task};
//# sourceMappingURL=nanostores.bundle.mjs.map